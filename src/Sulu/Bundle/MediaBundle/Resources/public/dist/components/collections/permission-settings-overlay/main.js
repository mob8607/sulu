define(function(){"use strict";var a="sulu.permission-settings.",b={instanceName:"",type:"",securityContext:""},c={permissionContentClass:"permission-content"},d=function(){return f.call(this,"closed")},e=function(){return f.call(this,"initialized")},f=function(b){return a+(this.options.instanceName?this.options.instanceName+".":"")+b};return{initialize:function(){if(!this.options.id)throw new Error("id is not defined");this.options=this.sandbox.util.extend(!0,{},b,this.options),this.bindEvents(),this.openOverlay(),this.sandbox.emit(e.call(this))},bindEvents:function(){this.sandbox.once("husky.overlay.permission-settings.opened",function(){this.startPermissionContent()}.bind(this))},openOverlay:function(){var a=this.sandbox.dom.createElement('<div class="overlay-element"/>');this.sandbox.dom.append(this.$el,a),this.sandbox.start([{name:"overlay@husky",options:{el:a,title:this.sandbox.translate("security.roles.permissions"),instanceName:"permission-settings",data:'<div class="'+c.permissionContentClass+'"/>',okCallback:this.savePermissionSettings.bind(this),cancelCallback:function(){this.sandbox.stop()}.bind(this),openOnStart:!0,removeOnClose:!0,propagateEvents:!1}}])},startPermissionContent:function(){this.sandbox.start([{name:"permission-tab@sulusecurity",options:{el:"."+c.permissionContentClass,id:this.options.id,type:this.options.type,securityContext:this.options.securityContext,inOverlay:!0}}])},savePermissionSettings:function(){this.sandbox.emit("sulu.permission-tab.save"),this.sandbox.once("sulu.permission-tab.saved",function(){this.sandbox.stop()}.bind(this)),this.sandbox.once("sulu.permission-tab.error",function(){this.sandbox.stop()}.bind(this))},destroy:function(){this.sandbox.emit(d.call(this))}}});