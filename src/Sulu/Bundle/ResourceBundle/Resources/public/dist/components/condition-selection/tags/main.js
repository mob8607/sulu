define(["underscore"],function(a){"use strict";return{defaults:{options:{value:null,operator:null}},tagToId:{},initialize:function(){this.$container=$("<div/>"),this.instanceName=a.uniqueId("condition-tags-"),this.value=this.options.value,this.$el.append(this.$container),this.$el.data("value",this.options.value),this.sandbox.start([{name:"auto-complete-list@husky",options:{el:this.$container,instanceName:this.instanceName,items:this.data,remoteUrl:"/admin/api/tags?flat=true&sortBy=name&searchFields=name",getParameter:"search",itemsKey:"tags",autocomplete:!0,noNewTags:!0}}]),this.sandbox.on("husky.auto-complete."+this.instanceName+".remote-data",this.addTags.bind(this)),this.sandbox.on("husky.auto-complete-list."+this.instanceName+".item-added",this.updateData.bind(this)),this.sandbox.on("husky.auto-complete-list."+this.instanceName+".item-deleted",this.updateData.bind(this))},addTags:function(a){for(var b=0,c=a.length;c>b;b++)this.addTag(a[b])},addTag:function(a){this.tagToId[a.name]=a.id},updateData:function(){this.sandbox.emit("husky.auto-complete-list."+this.instanceName+".get-tags",function(b){this.$el.data("value",a.map(b,function(a){return this.tagToId[a]}.bind(this))).trigger("change")}.bind(this))},loadComponentData:function(){var b=$.Deferred();return 0===this.options.value.length?(b.resolve([]),b.promise()):(this.sandbox.util.load("/admin/api/tags?flat=true&ids="+this.options.value.join(",")).then(function(c){b.resolve(a.map(c._embedded.tags,function(a){return this.addTag(a),a.name}.bind(this)))}.bind(this)),b.promise())}}});